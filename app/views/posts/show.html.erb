<div id="post_nav">
  <a onclick="goToByScroll('top')">&uarr;</a><br>
  –<br>
  <a onclick="goToByScroll('bottom')">&darr;</a>
</div>
<div id="top"></div>
<div class="hero-unit post_page_post">
  <div class="inline post_info">
    <p class="center">
      <%if current_user %>
      <% if current_user == @post.user %>
        <%= image_tag avatar_url(@post.user, 76), :class => 'current_user_pic' %>
      <% elsif @post.user.email == 'joahd@gbergfamily.com' %>
        <%= image_tag avatar_url(@post.user, 76), :class => 'admin_pic' %>
      <%else%>
        <%= image_tag avatar_url(@post.user, 76), :class => 'post_author_pic' %>
      <%end%>
      <%else%>
      <%= image_tag avatar_url(@post.user, 76), :class => 'post_author_pic' %>
      <%end%>
      <br><%= link_to @post.user.name, @post.user%> <span class="user_pluses">(+<%=collect_plus(@post.user)%>)</span> <br> <%= time_ago_in_words(@post.created_at) %> ago <br><%= @post.created_at.strftime("%b. %d %Y") %><br><small><%if current_user%><a href="#bottom">Comment</a><%end%> <% if current_user %><%if current_user == @post.user || current_user.email == 'joahd@gbergfamily.com'%>| <%= link_to 'Edit', edit_post_path(@post) %> | <%= link_to 'Delete', @post, method: :delete, data: { confirm: 'Are you sure?' } %><%end%><%end%></small> </p>
  </div>
  <div class="inline post_content">
    <h1> <%=@post.title%> </h1>
    <p class="inline comment_body"><p><%=raw render_body(@post)%></p></p>
  </div>
</div>



<% if @post.comments.length > 0 %>
  <% @post.comments.each do |comment| %>
    <div class="well">
      <div class="comment" id= <%=comment.id%> >
        <% if current_user %>
        <%= form_for @plusone do |f| %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :comment_id, :value => comment.id %>
        <%end%>
        <%end%>
        <% if current_user %>
          <% if current_user == comment.user %>
            <%= image_tag avatar_url(comment.user, 76), :class => 'current_user_pic comment_avatar' %>
          <% end %>
        <%end%>
      <% if comment.post.user == comment.user && current_user != comment.user %>
        <%= image_tag avatar_url(comment.user, 76), :class => 'post_author_pic comment_avatar' %>
      <%elsif comment.user.email == 'joahd@gbergfamily.com' && current_user != comment.user%>
        <%= image_tag avatar_url(comment.user, 76), :class => 'admin_pic comment_avatar' %>
        <%elsif current_user != comment.user%>
        <%= image_tag avatar_url(comment.user, 76), :class => 'comment_avatar' %>
      <%end%>



        <div class="inline comment_content">
           <p class="comment_info">Commented by <%= link_to comment.user.name, comment.user%> <span class="user_pluses">(+<%=collect_plus(comment.user)%>)</span> <%= time_ago_in_words(comment.created_at) %> ago.<% if current_user %><% if current_user == comment.user || current_user.email == 'joahd@gbergfamily.com'%> - <%= link_to 'Delete', comment, method: :delete %><%end%><%end%>
           </p>
        <%=raw render_body(comment)%>
        </div>
      </div>
<%if current_user%>
      <p id="plusones"><%= link_to '+'+(comment.plusones.length).to_s(), "#", :onclick=>"document.getElementById('#{comment.id}').getElementsByTagName('form')[0].submit()" %></p>
<%end%>
      <div id='nested_comments_container'>
        <% if comment.ncomments.length > 0 %>
          <% comment.ncomments.each do |ncomment| %>
            <p><% if current_user %><% if current_user == ncomment.user || current_user.email == 'joahd@gbergfamily.com' || current_user == ncomment.comment.user%><%= link_to '×', ncomment, method: :delete, :class => 'close' %><%end%><%end%> <%=link_to ncomment.user.name, ncomment.user%>:&nbsp;<%=ncomment.content%></p>
          <%end%>
        <%end%>
        <% if current_user %>
          <%= form_for @ncomment,  :html => {:class => 'navbar-form'} do |f|%>
            <%= f.text_field :content, :placeholder => "Comment...." %>
            <%= f.hidden_field :user_id, :value => current_user.id %>
            <%= f.hidden_field :comment_id, :value => comment.id %>
            <%= f.submit "Comment", :class => 'btn'%> 
        <% end %>
        <%else%>
          <span class="spalert">You have to be signed in to post comments.</span>
      <%end%>
    </div>
  </div>

  <%end%>

<%end%>

<%if current_user %>

<%= form_for(@comment) do |f| %>
<div class="well">
  <% if @comment.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this post from being saved:</h2>
      <ul>
      <% @comment.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="field">
    <div id="wmd-button-bar"></div>
    <%= f.text_area :content, :id => 'wmd-input', :class =>'full_wide get_me', :placeholder => "Comments Go Here..." %>
  </div>
  <%= f.hidden_field :user_id, :value => current_user.id %>
  <%= f.hidden_field :post_id, :value => @post.id %>
  <div class="actions comment_actions">
    <%= f.submit "Comment", :class => 'btn'%>
    &nbsp; &nbsp;&nbsp;<span class="note"> Comments are parsed with <a href="http://daringfireball.net/projects/markdown/syntax" target="_blank">Markdown Syntax</a></span>
  </div>
</div>
<% end %>
<%end%>

<div id="bottom"></div>